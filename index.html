<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Be My Valentine üíò</title>
  <meta name="theme-color" content="#ff4d6d" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <!-- Confetti + QR -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    :root{
      --pink:#ff4d6d;
      --pink-deep:#ff2e63;
      --bg-a:#ffe3ea;
      --bg-b:#fad0c4;
      --shadow:0 18px 40px rgba(255,77,109,.25);
      --safe-inset: 8px; /* NEW: engerer Rand f√ºr Mobile, damit NO sichtbar bleibt */
    }
    *{box-sizing:border-box}
    body{
      margin:0; 
      min-height:100svh;
      display:flex; 
      align-items:center; 
      justify-content:center;
      background: radial-gradient(1200px 800px at 20% 10%, var(--bg-a) 0%, var(--bg-b) 45%, #ff9a9e 100%);
      /* NEW: Scroll erlauben, damit Text unter Bild sichtbar wird */
      overflow:auto;
      font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* Herzchen-Hintergrund */
    .heart-field{position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden;}
    .floating-heart{
      position:absolute; color:#ff6b8f; opacity:.18;
      font-size:clamp(18px, 2.8vmin, 36px);
      animation:floatUp linear infinite;
      filter: drop-shadow(0 2px 0 rgba(255,255,255,.35));
    }
    @keyframes floatUp{
      0%{ transform:translateY(110vh) scale(1) rotate(0); opacity:0 }
      8%,92%{ opacity:.25 }
      100%{ transform:translateY(-20vh) scale(1.3) rotate(360deg); opacity:0 }
    }

    /* Karte */
    .card{
      position:relative; z-index:2;
      width:min(92vw, 560px);
      background: linear-gradient(145deg, rgba(255,255,255,.92), rgba(255,255,255,.85));
      backdrop-filter: blur(8px);
      border-radius:28px; padding:30px 26px 24px;
      box-shadow: var(--shadow);
      border:1px solid rgba(255,255,255,.6);
      text-align:center;
      margin: 24px 0; /* NEW: Platz oben/unten ‚Üí Scrollraum */
    }
    h1.title{
      font-family:'Pacifico', cursive; font-weight:400; margin:4px 0 12px;
      color:var(--pink); font-size:clamp(28px, 6vw, 44px); line-height:1.2;
      text-shadow:0 2px 0 rgba(255,255,255,.7);
    }

    .buttons{
      margin-top:18px;
      display:flex; gap:22px; justify-content:center; align-items:center;
      position:relative; z-index:2;
    }
    button{
      font:600 18px/1 'Poppins', sans-serif;
      border:none; padding:14px 28px; border-radius:999px;
      cursor:pointer; user-select:none; touch-action:manipulation;
      transition:transform .18s ease, box-shadow .18s ease, background .2s ease, color .2s ease;
    }
    #yes{
      background:linear-gradient(180deg, var(--pink), var(--pink-deep));
      color:#fff; box-shadow:0 10px 20px rgba(255,77,109,.35);
    }
    #yes:hover{ transform: translateY(-2px) scale(1.03); }
    #yes:active{ transform: translateY(0) scale(.98); }

    /* ‚ÄûNo‚Äú global fixiert (kann √ºber Seite fliehen) */
    #no{
      position:fixed; z-index:3;
      left:50%; top:50%; transform:translate(-50%,-50%);
      background:#fff; color:#444;
      border:1px solid rgba(0,0,0,.06);
      box-shadow:0 10px 22px rgba(0,0,0,.14);
      padding:12px 24px; white-space:nowrap;
      will-change: transform, left, top;
      touch-action:none;
    }

    .hint{ 
      margin-top:10px; color:#999; font-size:14px; font-style:italic; letter-spacing:.2px; 
    }

    /* Yay */
    #yay{ display:none; margin-top:10px; animation:pop .35s ease-out; }
    @keyframes pop{ from{transform:scale(.92); opacity:0} to{transform:scale(1); opacity:1} }
    #yay h2{ font-family:'Pacifico', cursive; color:var(--pink); font-size:clamp(28px,6vw,48px); margin:6px 0 8px; }
    #yay p{ font-size:clamp(18px, 4.2vw, 22px); margin:0 0 10px; }

    /* Foto-Container */
    .celebration-wrap{ display:none; margin:10px auto 0; }
    .celebration-img, .celebration-pdf{
      width:min(86%, 420px); height:auto; border-radius:20px; margin:0 auto;
      box-shadow:0 12px 28px rgba(255,77,109,.25); border:6px solid #fff; display:block;
    }
    .celebration-pdf{ height:460px; border-radius:18px; }

    /* Liebes-Zeile unter dem Bild */
    .love-line{ 
      margin:14px 0 6px; 
      font-weight:600; 
      font-size:clamp(18px, 4.2vw, 22px);
      color:#c81e53;
    }

    /* QR Icon (ohne Text) */
    .qr-fab{
      position:fixed; right:14px; top:14px; z-index:4;
      background:#fff; border-radius:14px; padding:8px 10px;
      border:1px solid rgba(0,0,0,.08); box-shadow:0 8px 22px rgba(0,0,0,.16);
      cursor:pointer; user-select:none;
    }
    .qr-modal{
      position:fixed; inset:0; display:none; place-items:center; z-index:5;
      background:rgba(0,0,0,.28);
    }
    .qr-card{
      background:#fff; padding:16px 14px 12px; border-radius:16px; box-shadow: var(--shadow);
    }
    #qrcode > img, #qrcode > canvas{
      width:160px !important; height:160px !important; image-rendering:pixelated;
      border-radius:12px; background:#fff; padding:8px; box-shadow:0 6px 16px rgba(0,0,0,.12);
    }

    button:focus-visible{ outline:3px solid rgba(255,77,109,.55); outline-offset:3px; }

    /* NEW: sanfteres Verhalten auf sehr kleinen Screens */
    @media (max-width: 480px){
      :root{ --safe-inset: 12px; }
    }
  </style>
</head>
<body>

  <!-- Herzchen -->
  <div class="heart-field" aria-hidden="true" id="heartField"></div>

  <div class="card" role="dialog" aria-labelledby="title">
    <h1 class="title" id="title">Elisea, will you be my Valentine? üíñ</h1>

    <div class="buttons" aria-live="polite" aria-atomic="true">
      <button id="yes" aria-label="Yes">Yes üíò</button>
      <!-- ‚ÄûNo‚Äú ist global fixiert; hier bleibt nur Yes -->
    </div>

    <!-- NEW: Hinweistext ge√§ndert -->
    <div class="hint" id="noHint">‚ÄûNo‚Äú ist sch√ºchtern üòò</div>

    <div id="yay" aria-live="polite">
      <h2>YAAAY üéâü•∞</h2>
      <p>üíÉüï∫üíû</p>

      <!-- Foto-Container: zeigt automatisch PDF (object) oder Bild (img) -->
      <div class="celebration-wrap" id="celebrationWrap"></div>

      <!-- NEW: Liebes-Zeile unter dem Bild -->
      <div class="love-line" id="loveLine" style="display:none;">
        Ich liebe dich √ºber alles, Prinzessin ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è
      </div>
    </div>
  </div>

  <!-- NO Button (fixed) -->
  <button id="no" aria-label="No">No üôà</button>

  <!-- QR Icon + Modal -->
  <div class="qr-fab" id="qrFab" title="QR anzeigen">üî≥</div>
  <div class="qr-modal" id="qrModal" role="dialog" aria-modal="true" aria-label="QR-Code">
    <div class="qr-card">
      <div id="qrcode" title="Scanne mich"></div>
    </div>
  </div>

  <script>
    /* ========== Herzchen-Hintergrund ========== */
    const field = document.getElementById('heartField');
    const HEARTS = 28;
    for (let i=0;i<HEARTS;i++){
      const el = document.createElement('div');
      el.className = 'floating-heart';
      el.textContent = '‚ù§';
      const left = Math.random()*100;
      const delay = Math.random()*8;
      const dur = 10 + Math.random()*12;
      const scale = 0.7 + Math.random()*1.2;
      el.style.left = left+'vw';
      el.style.animationDuration = dur+'s';
      el.style.animationDelay = (-delay)+'s';
      el.style.transform = `translateY(${110+Math.random()*30}vh) scale(${scale})`;
      field.appendChild(el);
    }

    /* ========== Elemente ========== */
    const noBtn   = document.getElementById('no');
    const yesBtn  = document.getElementById('yes');
    const yay     = document.getElementById('yay');
    const hint    = document.getElementById('noHint');
    const wrap    = document.getElementById('celebrationWrap');
    const titleEl = document.getElementById('title');       // NEW
    const loveEl  = document.getElementById('loveLine');    // NEW

    /* ========== Start-Positionen & Abst√§nde ========== */
    const SAFE_INSET = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--safe-inset')) || 8; // NEW
    const MARGIN = SAFE_INSET;
    const MIN_DISTANCE_TO_YES = 190; // kein √úberlappen
    // Basiswerte mit Anpassung f√ºr kleine Viewports
    const isSmall = () => Math.min(window.innerWidth, window.innerHeight) < 520; // NEW
    const baseSafe = () => isSmall() ? 120 : 160;  // NEW
    const basePush = () => isSmall() ? 220 : 280;  // NEW
    const EASE = 0.16;

    let SAFE_RADIUS  = baseSafe();
    let PUSH_STRENGTH = basePush();
    let pos = {x: window.innerWidth*0.72, y: window.innerHeight*0.58};
    let target = {...pos};
    let grownOnce = false;

    // initial positionieren (rechts neben der Karte)
    function placeNoInitial(){
      const card = document.querySelector('.card').getBoundingClientRect();
      const r = noBtn.getBoundingClientRect();
      const startX = Math.min(window.innerWidth - r.width - MARGIN, card.right + 24);
      const startY = Math.min(window.innerHeight - r.height - MARGIN, card.top + card.height*0.62);
      pos = clampToViewport(startX, startY);
      target = {...pos};
      applyNo();
      // NEW: Parameter f√ºr aktuelle Displaygr√∂√üe anpassen
      SAFE_RADIUS = baseSafe();
      PUSH_STRENGTH = basePush();
    }

    function applyNo(){
      noBtn.style.left = pos.x + 'px';
      noBtn.style.top  = pos.y + 'px';
    }

    function centerRect(el){
      const r = el.getBoundingClientRect();
      return {x:r.left + r.width/2, y:r.top + r.height/2, w:r.width, h:r.height, left:r.left, top:r.top};
    }

    function clampToViewport(x, y){
      const r = noBtn.getBoundingClientRect();
      const nx = Math.min(window.innerWidth - r.width - MARGIN, Math.max(MARGIN, x));
      const ny = Math.min(window.innerHeight - r.height - MARGIN, Math.max(MARGIN, y));
      return {x:nx, y:ny};
    }

    // weiches Tweening
    function tick(){
      pos.x += (target.x - pos.x) * EASE;
      pos.y += (target.y - pos.y) * EASE;
      applyNo();
      requestAnimationFrame(tick);
    }

    // Repulsion vom Cursor + Mindestabstand zu YES
    function flee(mx, my){
      const nc = centerRect(noBtn);
      const dx = nc.x - mx;
      const dy = nc.y - my;
      const dist = Math.hypot(dx, dy);

      let tx = nc.x, ty = nc.y;

      if (dist < SAFE_RADIUS){
        const ux = dx / (dist || 1), uy = dy / (dist || 1);
        // etwas weniger jitter auf Mobile
        const jitter = () => (Math.random()-0.5) * (isSmall() ? 30 : 50);
        tx += ux * PUSH_STRENGTH + jitter();
        ty += uy * PUSH_STRENGTH + jitter();
      }

      // Zus√§tzlich von YES fernhalten
      const yc = centerRect(yesBtn);
      const dyx = tx - yc.x, dyy = ty - yc.y;
      const d2 = Math.hypot(dyx, dyy);
      if (d2 < MIN_DISTANCE_TO_YES){
        const ux = dyx / (d2 || 1), uy = dyy / (d2 || 1);
        const push = (MIN_DISTANCE_TO_YES - d2) + 24;
        tx += ux * push;
        ty += uy * push;
      }

      // NEW: harte Begrenzung innerhalb des Viewports ‚Äì NO bleibt sichtbar
      const halfW = nc.w/2, halfH = nc.h/2;
      const clamped = clampToViewport(tx - halfW, ty - halfH);
      target = clamped;
    }

    // Mouse & Touch
    document.addEventListener('mousemove', e => flee(e.clientX, e.clientY));
    document.addEventListener('touchstart', e => {
      const t = e.touches[0]; if (t) flee(t.clientX, t.clientY);
    }, {passive:true});

    // Falls man ihn doch erreicht ‚Äì kleiner Not-Sprung
    noBtn.addEventListener('pointerenter', () => {
      const r = noBtn.getBoundingClientRect();
      const jumpX = r.left + (Math.random()*600 - 300);
      const jumpY = r.top  + (Math.random()*400 - 200);
      const c = clampToViewport(jumpX, jumpY);
      target = c;
    });

    // YES: einmalig gr√∂√üer + Yay, Foto, Konfetti + Titel ausblenden
    yesBtn.addEventListener('click', () => {
      if (!grownOnce){
        yesBtn.style.transform = 'scale(1.18)';
        setTimeout(()=> yesBtn.style.transform = 'scale(1.00)', 380);
        grownOnce = true;
      }
      yesBtn.style.display = 'none';
      noBtn.style.display = 'none';
      if (titleEl) titleEl.style.display = 'none';   // NEW: Titel weg
      hint.style.display = 'none';

      // Yay zeigen
      yay.style.display = 'block';

      // Foto einf√ºgen (PDF oder Bild)
      // HINWEIS: Passe diesen Dateinamen an, wenn du ein JPG/PNG/GIF nutzt.
      const PHOTO_FILE = "Love.jpeg"; // ggf. √§ndern, z. B.: "assets/cute.jpg"
      const isPdf = PHOTO_FILE.toLowerCase().endsWith('.pdf');
      wrap.innerHTML = isPdf
        ? `<object class="celebration-pdf" type="application/pdf" data="${PHOTO_FILE}" aria-label="Foto"></object>`
        : `<img class="celebration-img" src="${PHOTO_FILE}" alt="Unser Bild">`;
      wrap.style.display = 'block';

      // NEW: Liebeszeile zeigen (unter dem Bild, dadurch Scroll m√∂glich)
      loveEl.style.display = 'block';

      // Konfetti
      if (window.confetti){
        const end = Date.now() + 900;
        (function frame(){
          confetti({
            particleCount: 70,
            spread: 70,
            origin: { y: 0.6 },
            scalar: 0.9,
            colors: ['#ff4d6d','#ffd1dc','#ff9aa2','#ffe0e9','#ff6b8f']
          });
          if (Date.now() < end) requestAnimationFrame(frame);
        })();
      }
    });

    // QR: Icon toggelt Modal (kein extra Text im Layout)
    const qrFab = document.getElementById('qrFab');
    const qrModal = document.getElementById('qrModal');
    const qrBox = document.getElementById('qrcode');
    let qrBuilt = false;

    qrFab.addEventListener('click', () => {
      qrModal.style.display = 'grid';
      if (!qrBuilt && window.QRCode){
        const target = (location.origin && location.href.startsWith('http')) ? location.href : 'https://your-github-pages-url';
        new QRCode(qrBox, {
          text: target, width: 160, height: 160,
          colorDark: "#111111", colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H
        });
        qrBuilt = true;
      }
    });
    qrModal.addEventListener('click', (e) => {
      if (e.target === qrModal) qrModal.style.display = 'none';
    });

    // init
    window.addEventListener('load', () => {
      placeNoInitial();
      tick();
    });

    // Re-Layout bei Resize
    window.addEventListener('resize', placeNoInitial);
  </script>
</body>
</html>
